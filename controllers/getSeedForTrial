const db = require("../models");
const MaterialSample = db.materialSample;
const Occurrence = db.occurrence;
const PreservedSpecimen = db.preservedSpecimen;
const Sequelize = require("sequelize");
const { sequelize } = require("../models");
const { QueryTypes } = require('sequelize');
const Op = Sequelize.Op;


const getSeedsForTrial = (req, res) => {
    console.log(req.body.materialSample_catalogNumber)
    console.log(req.body.scientificName)
    console.log(req.body.earlyDate)
    console.log(req.body.lateDate)

    var seedQuery = `SELECT * FROM materialSamples AS ms LEFT JOIN occurrences AS o ON ms.occurrenceTableID = o.id WHERE ms.materialSampleType = 'seed'`
    
    if (req.body.materialSample_catalogNumber !== '') {
      seedQuery = `${seedQuery} AND ms.materialSample_catalogNumber = ${req.body.materialSample_catalogNumber}`;
      console.log(seedQuery)
    }
    
    if (typeof req.body.scientificName !== 'undefined') {
        seedQuery.concat(` AND o.scientificName = ${req.body.scientificName}`);
    }
    
    if (typeof req.body.earlyDate !== 'undefined' && typeof req.body.lateDate === 'undefined') {
        seedQuery.concat(` o.eventDate BETWEEN ${req.body.earlyDate} AND '2300-01-01'`)
    }
    
    if (typeof req.body.earlyDate !== 'undefined' && typeof req.body.lateDate !== 'undefined') {
        seedQuery.concat(` o.eventDate BETWEEN ${req.body.earlyDate} AND ${req.body.lateDate}`)
    }
    
    if (typeof req.body.earlyDate === 'undefined' && typeof req.body.lateDate !== 'undefined') {
        seedQuery.concat(` o.eventDate BETWEEN '1900-01-01' AND ${req.body.lateDate}`)
    }
    
}

// const getSeedsForTrial = (req, res) => {
//     MaterialSample.findAll(
//         {
//             where: {
//                 [Op.and]:
//                 [
//                 {materialSampleType: 'seed'},
//                 {materialSample_catalogNumber: req.body.materialSample_catalogNumber}
//                 ]
//             },
//             include: [{
//                 model: Occurrence,
//                 where: {
//                     [Op.or]:
//                     [{scientificName: req.body.scientificName},
//                    [
//                     {eventDate: {
//                         [Op.between]: [req.body.earlyDate, req.body.lateDate]
//                         }
//                     }
//                 ]]
//             }}]
// }
// )
// .then((data) => {
//     res.send(data)
// })
// .catch((err) => {
//     console.log(err)
//     })
// }

module.exports = {
    getSeedsForTrial
  };
