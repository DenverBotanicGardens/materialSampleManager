const db = require("../models");
const MaterialSample = db.materialSample;
const Occurrence = db.occurrence;
const PreservedSpecimen = db.preservedSpecimen;
const Sequelize = require("sequelize");
const { sequelize } = require("../models");
const { QueryTypes } = require('sequelize');
const Op = Sequelize.Op;

var seedQuery = [`SELECT * FROM materialSamples AS ms LEFT JOIN occurrences AS o ON ms.occurrenceTableID = o.id WHERE ms.materialSampleType = 'seed'`]

const getSeedsForTrial = (req, res) => {
    console.log(req.body.materialSample_catalogNumber)
    console.log(req.body.scientificName)
    console.log(req.body.earlyDate)
    console.log(req.body.lateDate)

    if (req.body.materialSample_catalogNumber !== '') {
        seedQuery.push(` AND ms.materialSample_catalogNumber = ${req.body.materialSample_catalogNumber}`);
    }
    console.log(seedQuery)

    if (req.body.scientificName !== '') {
        seedQuery.push(` AND o.scientificName = ${req.body.scientificName}`);
    }
    console.log(seedQuery)
    if (req.body.earlyDate !== '' && req.body.lateDate === '') {
        seedQuery.push(` o.eventDate BETWEEN '${req.body.earlyDate}' AND '2300-01-01'`)
    }
    console.log(seedQuery)
    if (req.body.earlyDate !== '' && req.body.lateDate !== '') {
        seedQuery.push(` o.eventDate BETWEEN '${req.body.earlyDate}' AND '${req.body.lateDate}'`)
    }
    console.log(seedQuery)
    if (req.body.earlyDate === '' && req.body.lateDate !== '') {
        seedQuery.push(` o.eventDate BETWEEN '1900-01-01' AND '${req.body.lateDate}'`)
    }
    fullSeedQuery = seedQuery.join()
    console.log(fullSeedQuery.replaceAll(',',''))
    seedQuery = [`SELECT * FROM materialSamples AS ms LEFT JOIN occurrences AS o ON ms.occurrenceTableID = o.id WHERE ms.materialSampleType = 'seed'`] 
}
    
    
    
    


// const getSeedsForTrial = (req, res) => {
//     MaterialSample.findAll(
//         {
//             where: {
//                 [Op.and]:
//                 [
//                 {materialSampleType: 'seed'},
//                 {materialSample_catalogNumber: req.body.materialSample_catalogNumber}
//                 ]
//             },
//             include: [{
//                 model: Occurrence,
//                 where: {
//                     [Op.or]:
//                     [{scientificName: req.body.scientificName},
//                    [
//                     {eventDate: {
//                         [Op.between]: [req.body.earlyDate, req.body.lateDate]
//                         }
//                     }
//                 ]]
//             }}]
// }
// )
// .then((data) => {
//     res.send(data)
// })
// .catch((err) => {
//     console.log(err)
//     })
// }

module.exports = {
    getSeedsForTrial
  };
